@page "/"

@using System.IO;
@using System.Text
@inject IFileReaderService fileReaderService;

<h1>Hello, world!</h1>

<input type="file" @ref=inputTypeFileElement /><button @onclick=ReadFile>Read file</button>

<input @bind="Text" />

@functions {

    string Text;
    ElementReference inputTypeFileElement;

    public async Task ReadFile()
    {
        foreach (IFileReference file in await fileReaderService.CreateReference(inputTypeFileElement).EnumerateFilesAsync())
        {
            // Read into buffer and act (uses less memory)
            //await using (Stream stream = await file.OpenReadAsync()) {
            //    // Do (async) stuff with stream...
            //    await stream.ReadAsync(buffer, ...);
            //    // The following will fail. Only async read is allowed.
            //    stream.Read(buffer, ...)
            //}

            var fileInfo = await file.ReadFileInfoAsync();

            // Read into memory and act
            using (MemoryStream memoryStream = await file.CreateMemoryStreamAsync(4096))
            {
                Text = Encoding.UTF8.GetString(memoryStream.ToArray());
            }
        }
    }
}